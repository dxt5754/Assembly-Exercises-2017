


ARM Macro Assembler    Page 1 Timer Driver Input Timing


    1 00000000                 TTL              Timer Driver Input Timing
    2 00000000         ;*******************************************************
                       *********
    3 00000000         ;Uses Periodic Interrupt Timer with channel zero
    4 00000000         ;to implement timing measurements accurate to within 10m
                       s
    5 00000000         ;Name:  Dean Trivisani
    6 00000000         ;Date:  11/12/2017
    7 00000000         ;Class:  CMPE-250
    8 00000000         ;Section:  01L5
    9 00000000         ;-------------------------------------------------------
                       --------
   10 00000000         ;Keil Template for KL46
   11 00000000         ;R. W. Melton
   12 00000000         ;September 25, 2017
   13 00000000         ;*******************************************************
                       *********
   14 00000000         ;Assembler directives
   15 00000000                 THUMB
   17 00000000         ;*******************************************************
                       *********
   18 00000000         ;Include files
   19 00000000                 GET              MKL46Z4.s   ;Included by start.
                                                            s
   21 00000000         ;*******************************************************
                       *********
   22 00000000         ;EQUates
   23 00000000         
   24 00000000         ;-------------------------------------------------------
                       --------
   25 00000000         ;NVIC_ICER
   26 00000000         ;31-00:CLRENA=masks for HW IRQ sources;
   27 00000000         ;             read:   0 = unmasked;   1 = masked
   28 00000000         ;             write:  0 = no effect;  1 = mask
   29 00000000         ;12:UART0 IRQ mask
   30 00000000 00001000 
                       NVIC_ICER_UART0_MASK
                               EQU              UART0_IRQ_MASK
   31 00000000         ;-------------------------------------------------------
                       --------
   32 00000000         ;NVIC_ICPR
   33 00000000         ;31-00:CLRPEND=pending status for HW IRQ sources;
   34 00000000         ;             read:   0 = not pending;  1 = pending
   35 00000000         ;             write:  0 = no effect;
   36 00000000         ;                     1 = change status to not pending
   37 00000000         ;12:UART0 IRQ pending status
   38 00000000 00001000 
                       NVIC_ICPR_UART0_MASK
                               EQU              UART0_IRQ_MASK
   39 00000000         ;-------------------------------------------------------
                       --------
   40 00000000         ;NVIC_IPR0-NVIC_IPR7
   41 00000000         ;2-bit priority:  00 = highest; 11 = lowest
   42 00000000 00000003 
                       UART0_IRQ_PRIORITY
                               EQU              3
   43 00000000 000000C0 
                       NVIC_IPR_UART0_MASK
                               EQU              (3 << UART0_PRI_POS)



ARM Macro Assembler    Page 2 Timer Driver Input Timing


   44 00000000 000000C0 
                       NVIC_IPR_UART0_PRI_3
                               EQU              (UART0_IRQ_PRIORITY << UART0_PR
I_POS)
   45 00000000         ;-------------------------------------------------------
                       --------
   46 00000000         ;NVIC_ISER
   47 00000000         ;31-00:SETENA=masks for HW IRQ sources;
   48 00000000         ;             read:   0 = masked;     1 = unmasked
   49 00000000         ;             write:  0 = no effect;  1 = unmask
   50 00000000         ;12:UART0 IRQ mask
   51 00000000 00001000 
                       NVIC_ISER_UART0_MASK
                               EQU              UART0_IRQ_MASK
   52 00000000         ;-------------------------------------------------------
                       --------
   53 00000000         ;PIT_LDVALn:  PIT load value register n
   54 00000000         ;31-00:TSV=timer start value (period in clock cycles - 1
                       )
   55 00000000         ;Clock ticks for 0.01 s at 24 MHz count rate
   56 00000000         ;0.01 s * 24,000,000 Hz = 240,000
   57 00000000         ;TSV = 240,000 - 1
   58 00000000 0003A97F 
                       PIT_LDVAL_0
                               EQU              239999
   59 00000000         ;-------------------------------------------------------
                       --------
   60 00000000         ;PIT_MCR:  PIT module control register
   61 00000000         ;1-->    0:FRZ=freeze (continue'/stop in debug mode)
   62 00000000         ;0-->    1:MDIS=module disable (PIT section)
   63 00000000         ;               RTI timer not affected
   64 00000000         ;               must be enabled before any other PIT set
                       up
   65 00000000 00000001 
                       PIT_MCR_EN_FRZ
                               EQU              PIT_MCR_FRZ_MASK
   66 00000000         ;-------------------------------------------------------
                       --------
   67 00000000         ;PIT_TCTRLn:  PIT timer control register n
   68 00000000         ;0-->   2:CHN=chain mode (enable)
   69 00000000         ;1-->   1:TIE=timer interrupt enable
   70 00000000         ;1-->   0:TEN=timer enable
   71 00000000 00000003 
                       PIT_TCTRL_CH_IE
                               EQU              (PIT_TCTRL_TEN_MASK :OR: PIT_TC
TRL_TIE_MASK)
   72 00000000         ;-------------------------------------------------------
                       --------
   73 00000000         ;PORTx_PCRn (Port x pin control register n [for pin n])
   74 00000000         ;___->10-08:Pin mux control (select 0 to 8)
   75 00000000         ;Use provided PORT_PCR_MUX_SELECT_2_MASK
   76 00000000         ;-------------------------------------------------------
                       --------
   77 00000000         ;Port A
   79 00000000 01000200 
                       PORT_PCR_SET_PTA1_UART0_RX
                               EQU              (PORT_PCR_ISF_MASK :OR:       
                             PORT_PCR_MUX_SELECT_2_MASK)
   81 00000000 01000200 



ARM Macro Assembler    Page 3 Timer Driver Input Timing


                       PORT_PCR_SET_PTA2_UART0_TX
                               EQU              (PORT_PCR_ISF_MASK :OR:       
                             PORT_PCR_MUX_SELECT_2_MASK)
   82 00000000         ;-------------------------------------------------------
                       --------
   83 00000000         ;SIM_SCGC4
   84 00000000         ;1->10:UART0 clock gate control (enabled)
   85 00000000         ;Use provided SIM_SCGC4_UART0_MASK
   86 00000000         ;-------------------------------------------------------
                       --------
   87 00000000         ;SIM_SCGC5
   88 00000000         ;1->09:Port A clock gate control (enabled)
   89 00000000         ;Use provided SIM_SCGC5_PORTA_MASK
   90 00000000         ;-------------------------------------------------------
                       --------
   91 00000000         ;SIM_SOPT2
   92 00000000         ;01=27-26:UART0SRC=UART0 clock source select
   93 00000000         ;         (PLLFLLSEL determines MCGFLLCLK' or MCGPLLCLK/
                       2)
   94 00000000         ; 1=   16:PLLFLLSEL=PLL/FLL clock select (MCGPLLCLK/2)
   96 00000000 04000000 
                       SIM_SOPT2_UART0SRC_MCGPLLCLK
                               EQU              (1 << SIM_SOPT2_UART0SRC_SHIFT)
   98 00000000 04010000 
                       SIM_SOPT2_UART0_MCGPLLCLK_DIV2
                               EQU              (SIM_SOPT2_UART0SRC_MCGPLLCLK :
OR: SIM_SOPT2_PLLFLLSEL_MASK)
   99 00000000         ;-------------------------------------------------------
                       --------
  100 00000000         ;SIM_SOPT5
  101 00000000         ; 0->   16:UART0 open drain enable (disabled)
  102 00000000         ; 0->   02:UART0 receive data select (UART0_RX)
  103 00000000         ;00->01-00:UART0 transmit data select source (UART0_TX)
  107 00000000 00010007 
                       SIM_SOPT5_UART0_EXTERN_MASK_CLEAR
                               EQU              (SIM_SOPT5_UART0ODE_MASK :OR:  
                                SIM_SOPT5_UART0RXSRC_MASK :OR:               
                   SIM_SOPT5_UART0TXSRC_MASK)
  108 00000000         ;-------------------------------------------------------
                       --------
  109 00000000         ;UART0_BDH
  110 00000000         ;    0->  7:LIN break detect IE (disabled)
  111 00000000         ;    0->  6:RxD input active edge IE (disabled)
  112 00000000         ;    0->  5:Stop bit number select (1)
  113 00000000         ;00001->4-0:SBR[12:0] (UART0CLK / [9600 * (OSR + 1)]) 
  114 00000000         ;UART0CLK is MCGPLLCLK/2
  115 00000000         ;MCGPLLCLK is 96 MHz
  116 00000000         ;MCGPLLCLK/2 is 48 MHz
  117 00000000         ;SBR = 48 MHz / (9600 * 16) = 312.5 --> 312 = 0x138
  118 00000000 00000001 
                       UART0_BDH_9600
                               EQU              0x01
  119 00000000         ;-------------------------------------------------------
                       --------
  120 00000000         ;UART0_BDL
  121 00000000         ;26->7-0:SBR[7:0] (UART0CLK / [9600 * (OSR + 1)])
  122 00000000         ;UART0CLK is MCGPLLCLK/2
  123 00000000         ;MCGPLLCLK is 96 MHz
  124 00000000         ;MCGPLLCLK/2 is 48 MHz



ARM Macro Assembler    Page 4 Timer Driver Input Timing


  125 00000000         ;SBR = 48 MHz / (9600 * 16) = 312.5 --> 312 = 0x138
  126 00000000 00000038 
                       UART0_BDL_9600
                               EQU              0x38
  127 00000000         ;-------------------------------------------------------
                       --------
  128 00000000         ;UART0_C1
  129 00000000         ;0-->7:LOOPS=loops select (normal)
  130 00000000         ;0-->6:DOZEEN=doze enable (disabled)
  131 00000000         ;0-->5:RSRC=receiver source select (internal--no effect 
                       LOOPS=0)
  132 00000000         ;0-->4:M=9- or 8-bit mode select 
  133 00000000         ;        (1 start, 8 data [lsb first], 1 stop)
  134 00000000         ;0-->3:WAKE=receiver wakeup method select (idle)
  135 00000000         ;0-->2:IDLE=idle line type select (idle begins after sta
                       rt bit)
  136 00000000         ;0-->1:PE=parity enable (disabled)
  137 00000000         ;0-->0:PT=parity type (even parity--no effect PE=0)
  138 00000000 00000000 
                       UART0_C1_8N1
                               EQU              0x00
  139 00000000         ;-------------------------------------------------------
                       --------
  140 00000000         ;UART0_C2
  141 00000000         ;0-->7:TIE=transmit IE for TDRE (disabled)
  142 00000000         ;0-->6:TCIE=transmission complete IE for TC (disabled)
  143 00000000         ;0-->5:RIE=receiver IE for RDRF (disabled)
  144 00000000         ;0-->4:ILIE=idle line IE for IDLE (disabled)
  145 00000000         ;1-->3:TE=transmitter enable (enabled)
  146 00000000         ;1-->2:RE=receiver enable (enabled)
  147 00000000         ;0-->1:RWU=receiver wakeup control (normal)
  148 00000000         ;0-->0:SBK=send break (disabled, normal)
  149 00000000 0000000C 
                       UART0_C2_T_R
                               EQU              (UART0_C2_TE_MASK :OR: UART0_C2
_RE_MASK)
  150 00000000 0000002C 
                       UART0_C2_T_RI
                               EQU              (UART0_C2_RIE_MASK :OR: UART0_C
2_T_R)
  151 00000000 000000AC 
                       UART0_C2_TI_RI
                               EQU              (UART0_C2_TIE_MASK :OR: UART0_C
2_T_RI)
  152 00000000         ;-------------------------------------------------------
                       --------
  153 00000000         ;UART0_C3
  154 00000000         ;0-->7:R8T9=9th data bit for receiver (not used M=0)
  155 00000000         ;           10th data bit for transmitter (not used M10=
                       0)
  156 00000000         ;0-->6:R9T8=9th data bit for transmitter (not used M=0)
  157 00000000         ;           10th data bit for receiver (not used M10=0)
  158 00000000         ;0-->5:TXDIR=UART_TX pin direction in single-wire mode
  159 00000000         ;            (no effect LOOPS=0)
  160 00000000         ;0-->4:TXINV=transmit data inversion (not inverted)
  161 00000000         ;0-->3:ORIE=overrun IE for OR (disabled)
  162 00000000         ;0-->2:NEIE=noise error IE for NF (disabled)
  163 00000000         ;0-->1:FEIE=framing error IE for FE (disabled)
  164 00000000         ;0-->0:PEIE=parity error IE for PF (disabled)



ARM Macro Assembler    Page 5 Timer Driver Input Timing


  165 00000000 00000000 
                       UART0_C3_NO_TXINV
                               EQU              0x00
  166 00000000         ;-------------------------------------------------------
                       --------
  167 00000000         ;UART0_C4
  168 00000000         ;    0-->  7:MAEN1=match address mode enable 1 (disabled
                       )
  169 00000000         ;    0-->  6:MAEN2=match address mode enable 2 (disabled
                       )
  170 00000000         ;    0-->  5:M10=10-bit mode select (not selected)
  171 00000000         ;01111-->4-0:OSR=over sampling ratio (16)
  172 00000000         ;               = 1 + OSR for 3 <= OSR <= 31
  173 00000000         ;               = 16 for 0 <= OSR <= 2 (invalid values)
  174 00000000 0000000F 
                       UART0_C4_OSR_16
                               EQU              0x0F
  175 00000000 0000000F 
                       UART0_C4_NO_MATCH_OSR_16
                               EQU              UART0_C4_OSR_16
  176 00000000         ;-------------------------------------------------------
                       --------
  177 00000000         ;UART0_C5
  178 00000000         ;  0-->  7:TDMAE=transmitter DMA enable (disabled)
  179 00000000         ;  0-->  6:Reserved; read-only; always 0
  180 00000000         ;  0-->  5:RDMAE=receiver full DMA enable (disabled)
  181 00000000         ;000-->4-2:Reserved; read-only; always 0
  182 00000000         ;  0-->  1:BOTHEDGE=both edge sampling (rising edge only
                       )
  183 00000000         ;  0-->  0:RESYNCDIS=resynchronization disable (enabled)
                       
  184 00000000 00000000 
                       UART0_C5_NO_DMA_SSR_SYNC
                               EQU              0x00
  185 00000000         ;-------------------------------------------------------
                       --------
  186 00000000         ;UART0_S1
  187 00000000         ;0-->7:TDRE=transmit data register empty flag; read-only
                       
  188 00000000         ;0-->6:TC=transmission complete flag; read-only
  189 00000000         ;0-->5:RDRF=receive data register full flag; read-only
  190 00000000         ;1-->4:IDLE=idle line flag; write 1 to clear (clear)
  191 00000000         ;1-->3:OR=receiver overrun flag; write 1 to clear (clear
                       )
  192 00000000         ;1-->2:NF=noise flag; write 1 to clear (clear)
  193 00000000         ;1-->1:FE=framing error flag; write 1 to clear (clear)
  194 00000000         ;1-->0:PF=parity error flag; write 1 to clear (clear)
  195 00000000 0000001F 
                       UART0_S1_CLEAR_FLAGS
                               EQU              0x1F
  196 00000000         ;-------------------------------------------------------
                       --------
  197 00000000         ;UART0_S2
  198 00000000         ;1-->7:LBKDIF=LIN break detect interrupt flag (clear)
  199 00000000         ;             write 1 to clear
  200 00000000         ;1-->6:RXEDGIF=RxD pin active edge interrupt flag (clear
                       )
  201 00000000         ;              write 1 to clear
  202 00000000         ;0-->5:(reserved); read-only; always 0



ARM Macro Assembler    Page 6 Timer Driver Input Timing


  203 00000000         ;0-->4:RXINV=receive data inversion (disabled)
  204 00000000         ;0-->3:RWUID=receive wake-up idle detect
  205 00000000         ;0-->2:BRK13=break character generation length (10)
  206 00000000         ;0-->1:LBKDE=LIN break detect enable (disabled)
  207 00000000         ;0-->0:RAF=receiver active flag; read-only
  208 00000000 000000C0 
                       UART0_S2_NO_RXINV_BRK10_NO_LBKDETECT_CLEAR_FLAGS
                               EQU              0xC0
  209 00000000         ;-------------------------------------------------------
                       --------
  210 00000000         
  211 00000000 00000000 
                       PIT_IRQ_PRI
                               EQU              0
  212 00000000 0000004F 
                       MAX_STRING
                               EQU              79
  213 00000000 000003E8 
                       DIV1K   EQU              0x3E8
  214 00000000 00002710 
                       DIV10K  EQU              0x2710
  215 00000000 000186A0 
                       DIV100K EQU              0x186A0
  216 00000000 000F4240 
                       DIV1M   EQU              0xF4240
  217 00000000 00000000 
                       IN_PTR  EQU              0
  218 00000000 00000004 
                       OUT_PTR EQU              4
  219 00000000 00000008 
                       BUF_STRT
                               EQU              8
  220 00000000 0000000C 
                       BUF_PAST
                               EQU              12
  221 00000000 00000010 
                       BUF_SIZE
                               EQU              16
  222 00000000 00000011 
                       NUM_ENQD
                               EQU              17
  223 00000000 00000004 
                       Q_BUF_SZ
                               EQU              4
  224 00000000 00000012 
                       Q_REC_SZ
                               EQU              18
  225 00000000         
  226 00000000         ;*******************************************************
                       *********
  227 00000000         ;Program
  228 00000000         ;Linker requires Reset_Handler
  229 00000000                 AREA             MyCode,CODE,READONLY
  230 00000000                 ENTRY
  231 00000000                 EXPORT           Reset_Handler
  232 00000000                 EXPORT           PutChar
  233 00000000                 IMPORT           Startup
  234 00000000         Reset_Handler
                               PROC             {},{}



ARM Macro Assembler    Page 7 Timer Driver Input Timing


  235 00000000         main
  236 00000000         ;-------------------------------------------------------
                       --------
  237 00000000         ;Mask interrupts
  238 00000000 B672            CPSID            I
  239 00000002         ;KL46 system startup with 48-MHz system clock
  240 00000002 F7FF FFFE       BL               Startup
  241 00000006         ;Enable interrupts
  242 00000006 F7FF FFFE       BL               Init_UART0_IRQ
  243 0000000A         ;initialize prompt counter
  244 0000000A 2200            MOVS             R2,#0
  245 0000000C F000 F927       BL               NEWLINE
  246 00000010         MainLoop
  247 00000010 F000 F925       BL               NEWLINE
  248 00000014         ;initialize RunStopWatch and Count at 0
  249 00000014 481D            LDR              R0, =RunStopWatch
  250 00000016 2100            MOVS             R1, #0
  251 00000018 7001            STRB             R1, [R0, #0]
  252 0000001A 481D            LDR              R0, =Count
  253 0000001C 2100            MOVS             R1, #0
  254 0000001E 6001            STR              R1, [R0, #0]
  255 00000020 F7FF FFFE       BL               Init_PIT_IRQ
  256 00000024         ;print the prompt corresponding
  257 00000024         ;to the counter
  258 00000024 2A01            CMP              R2, #1
  259 00000026 D002            BEQ              RUN2
  260 00000028 D803            BHI              RUN3
  261 0000002A 481A            LDR              R0, =Prompt1
  262 0000002C E002            B                PRINTIT
  263 0000002E 481A    RUN2    LDR              R0, =Prompt2
  264 00000030 E000            B                PRINTIT
  265 00000032 481A    RUN3    LDR              R0, =Prompt3
  266 00000034         
  267 00000034 F7FF FFFE 
                       PRINTIT BL               PutStringSB
  268 00000038 F000 F911       BL               NEWLINE
  269 0000003C 203E            MOVS             R0, #">"
  270 0000003E F7FF FFFE       BL               PutChar
  271 00000042         ;itnitalize Count to 0
  272 00000042 4813            LDR              R0, =Count
  273 00000044 2100            MOVS             R1, #0
  274 00000046 6001            STR              R1, [R0, #0]
  275 00000048         ;initalize RunStopwatch to 1
  276 00000048 4810            LDR              R0, =RunStopWatch
  277 0000004A 2101            MOVS             R1, #1
  278 0000004C 7001            STRB             R1, [R0, #0]
  279 0000004E         ;get string from terminal
  280 0000004E 214F            MOVS             R1, #MAX_STRING
  281 00000050 4813            LDR              R0, =STRINGIN
  282 00000052 F7FF FFFE       BL               GetStringSB
  283 00000056         ;initialize RunStopWatch to 0
  284 00000056 480D            LDR              R0, =RunStopWatch
  285 00000058 2100            MOVS             R1, #0
  286 0000005A 7001            STRB             R1, [R0, #0]
  287 0000005C 203C            MOVS             R0, #'<'
  288 0000005E F7FF FFFE       BL               PutChar
  289 00000062         ;print the value of Count
  290 00000062 480B            LDR              R0, =Count
  291 00000064 6800            LDR              R0, [R0, #0]



ARM Macro Assembler    Page 8 Timer Driver Input Timing


  292 00000066 0001            MOVS             R1, R0
  293 00000068 F7FF FFFE       BL               PutNumU
  294 0000006C         ;print " x .01 s"
  295 0000006C 480D            LDR              R0, =TimeFrmtTxt
  296 0000006E F7FF FFFE       BL               PutStringSB
  297 00000072 F000 F8F4       BL               NEWLINE
  298 00000076         ;increment prompt counter
  299 00000076 1C52            ADDS             R2,R2,#1
  300 00000078 2A03            CMP              R2, #3
  301 0000007A         ;thank user and exit if all
  302 0000007A         ;prompts have been filled in
  303 0000007A         ;else loop with next prompt
  304 0000007A D3C9            BLO              MainLoop
  305 0000007C F000 F8EF       BL               NEWLINE
  306 00000080 4809            LDR              R0, =ThxPrompt
  307 00000082 F7FF FFFE       BL               PutStringSB
  308 00000086 F000 F8EA       BL               NEWLINE
  309 0000008A         
  310 0000008A         ;>>>>>   end main program code <<<<<
  311 0000008A         ;Stay here
  312 0000008A                 ENDP
  313 0000008A E7FE            B                .
  314 0000008C 00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000         LTORG
  315 000000BC         ;>>>>> begin subroutine code <<<<<
  316 000000BC         InitQueue
                               PROC             {R0-R14},{}
  317 000000BC         ;Initializes the queue record structure at the 
  318 000000BC         ;address in R1 for the empty queue buffer at 
  319 000000BC         ;the address in R0 of size, 
  320 000000BC         ;(i.e., character capacity), given in R2.
  321 000000BC         ;Calls:
  322 000000BC         ;Input: R0, R1, R2
  323 000000BC         ;Output:  
  324 000000BC         ;Register Modiciations:
  325 000000BC B50F            PUSH             {R0-R3,LR}  ;preserve register 
                                                            values      
  326 000000BE 6008            STR              R0,[R1,#IN_PTR] ;sets the queue
                                                             buffer address to 
                                                            InPointer
  327 000000C0 6048            STR              R0,[R1,#OUT_PTR] ;"    " "    "
                                                                "    " OutPoint
                                                            er
  328 000000C2 6088            STR              R0,[R1,#BUF_STRT] ;sets the buf
                                                            fer start address t
                                                            o the queue buffer 
                                                            address
  329 000000C4 2204            MOVS             R2,#Q_BUF_SZ
  330 000000C6 1883            ADDS             R3,R0,R2    ;adds the buffer si



ARM Macro Assembler    Page 9 Timer Driver Input Timing


                                                            ze to the buffer st
                                                            arting address
  331 000000C8 60CB            STR              R3,[R1,#BUF_PAST] ;store this n
                                                            ew address
  332 000000CA 740A            STRB             R2,[R1,#BUF_SIZE] ;set the buff
                                                            er size to 4
  333 000000CC 2300            MOVS             R3,#0       ;clear R3
  334 000000CE 744B            STRB             R3,[R1,#NUM_ENQD] ;clear enqueu
                                                            ed number
  335 000000D0 BD0F            POP              {R0-R3,PC}  ;restore register v
                                                            alues
  336 000000D2         
  337 000000D2                 ENDP
  338 000000D2         
  339 000000D2         
  340 000000D2         Dequeue PROC             {R0-R14},{}
  341 000000D2         ;Attempts to get a character from the queue 
  342 000000D2         ;whose record structure’s address is in R1:  
  343 000000D2         ;if the queue is not empty, dequeues a single
  344 000000D2         ; character from the queue to R0, and returns 
  345 000000D2         ;with the PSRC bit cleared, (i.e., 0), to report 
  346 000000D2         ;dequeue success; otherwise, returns with the 
  347 000000D2         ;PSRC bit set, (i.e., 1) to report dequeue failure.
  348 000000D2         ;Inputs: R1
  349 000000D2         ;Outputs: R0, C
  350 000000D2 B41E            PUSH             {R1, R2, R3, R4}
  351 000000D4 7C4B            LDRB             R3, [R1, #NUM_ENQD] ;set flag i
                                                            f no queued
  352 000000D6 2B00            CMP              R3, #0
  353 000000D8 D014            BEQ              INVALID
  354 000000DA 6848            LDR              R0, [R1, #OUT_PTR] ;R0 <- value
                                                            
  355 000000DC 7800            LDRB             R0, [R0, #0]
  356 000000DE 7C4B            LDRB             R3, [R1, #NUM_ENQD] 
                                                            ;NumEnqueued -=1
  357 000000E0 1E5B            SUBS             R3, R3, #1
  358 000000E2 744B            STRB             R3, [R1, #NUM_ENQD]
  359 000000E4 684B            LDR              R3, [R1, #OUT_PTR] 
                                                            ;OutPointer +=1
  360 000000E6 1C5B            ADDS             R3, R3, #1
  361 000000E8 604B            STR              R3, [R1, #OUT_PTR]
  362 000000EA 68CC            LDR              R4, [R1, #BUF_PAST] ;if OutPoin
                                                            ter >= BufferPast, 
                                                            wrap,
  363 000000EC 42A3            CMP              R3, R4
  364 000000EE D301            BLO              CLEARC
  365 000000F0 688B            LDR              R3, [R1, #BUF_STRT] ;OutPointer
                                                             = BufferStart
  366 000000F2 604B            STR              R3, [R1, #OUT_PTR] ;wrap 
  367 000000F4         CLEARC
  368 000000F4 F3EF 8100       MRS              R1, APSR    ;clears C
  369 000000F8 2320            MOVS             R3, #0x20
  370 000000FA 0609            LSLS             R1, R1, #24
  371 000000FC 4399            BICS             R1, R1, R3
  372 000000FE F381 8800       MSR              APSR, R1
  373 00000102 E006            B                DQQUITT     ;quit
  374 00000104         INVALID
  375 00000104 F3EF 8100       MRS              R1, APSR    ;set C
  376 00000108 2320            MOVS             R3, #0x20



ARM Macro Assembler    Page 10 Timer Driver Input Timing


  377 0000010A 061B            LSLS             R3, R3, #24
  378 0000010C 4319            ORRS             R1, R1, R3
  379 0000010E F381 8800       MSR              APSR, R1
  380 00000112         
  381 00000112         DQQUITT
  382 00000112 BC1E            POP              {R1, R2, R3, R4} ;restore regis
                                                            ter values
  383 00000114 4770            BX               LR          ;exit subroutine
  384 00000116         
  385 00000116                 ENDP
  386 00000116         
  387 00000116         Enqueue PROC             {R0-R14},{}
  388 00000116         ;Attempts to put a character in the queue
  389 00000116         ; whose queue record structure’s address
  390 00000116         ; is in R1—if the queue is not full, enqueues
  391 00000116         ; the single character from R0 to the queue, 
  392 00000116         ;and returns with the PSRC cleared to 
  393 00000116         ;report enqueue success; otherwise, returns 
  394 00000116         ;with the PSRC bit set to report enqueue failure.
  395 00000116         ;Calls:
  396 00000116         ;Input: R0,R1
  397 00000116         ;Output: PSR C flag flag (0 = success, 1 = failure)
  398 00000116         ;Register Modiciations: No registers, PSR
  399 00000116 B478            PUSH             {R3-R6}     ;preserve register 
                                                            values
  400 00000118 7C4B            LDRB             R3,[R1,#NUM_ENQD] 
                                                            ;R3 <- NumEnqueued
  401 0000011A 7C0C            LDRB             R4,[R1,#BUF_SIZE] 
                                                            ;R4 <- BufferSize
  402 0000011C 42A3            CMP              R3,R4       ;if value >= buffer
                                                             size, go to carry
  403 0000011E D211            BHS              CARRY
  404 00000120 680D            LDR              R5,[R1,#IN_PTR] 
                                                            ;R5 <- InPointer
  405 00000122 68CE            LDR              R6,[R1,#BUF_PAST] 
                                                            ;R6 <- BufferPast
  406 00000124 7028            STRB             R0,[R5,#0]  ;store value at InP
                                                            ointer
  407 00000126 1C5B            ADDS             R3,R3,#1    ;NumEnqueued += 1
  408 00000128 744B            STRB             R3,[R1,#NUM_ENQD] 
                                                            ;R3 <- NumEnqueued
  409 0000012A 1C6D            ADDS             R5,R5,#1    ;InPointer += 1
  410 0000012C 42B5            CMP              R5,R6       ;if Inpointer < Buf
                                                            ferPast, skip reset
                                                            
  411 0000012E D300            BLO              SKIP
  412 00000130 688D            LDR              R5,[R1,#BUF_STRT] 
                                                            ;reset InPointer
  413 00000132         SKIP
  414 00000132 600D            STR              R5,[R1,#IN_PTR] 
                                                            ;Inpointer <- R1
  415 00000134 F3EF 8300       MRS              R3,APSR     ;R3 <- APSR
  416 00000138 2420            MOVS             R4,#0x20    ;R4 <- #0x20, for l
                                                            ogic
  417 0000013A 0624            LSLS             R4,R4,#24   ;shift to MSB
  418 0000013C 43A3            BICS             R3,R3,R4    ;clear C
  419 0000013E F383 8800       MSR              APSR,R3
  420 00000142 E006            B                EQQUITT     ;quit
  421 00000144         CARRY



ARM Macro Assembler    Page 11 Timer Driver Input Timing


  422 00000144 F3EF 8300       MRS              R3,APSR     ;set C
  423 00000148 2420            MOVS             R4,#0x20
  424 0000014A 0624            LSLS             R4,R4,#24
  425 0000014C 4323            ORRS             R3,R3,R4
  426 0000014E F383 8800       MSR              APSR,R3
  427 00000152         EQQUITT
  428 00000152 BC78            POP              {R3-R6}     ;restore register v
                                                            alues 
  429 00000154 4770            BX               LR          ;exit subroutine
  430 00000156         
  431 00000156                 ENDP
  432 00000156         
  433 00000156         
  434 00000156         GetStringSB
                               PROC             {R0-R14},{}
  435 00000156         ;Read & store string from command line
  436 00000156         ;Calls: GetChar, PutChar
  437 00000156         ;Input: R0, R1 
  438 00000156         ;Output: Prints to command line
  439 00000156         ;Register Modifications:  
  440 00000156 B50F            PUSH             {R0,R1,R2,R3,LR} ;store registe
                                                            r vallues
  441 00000158 1E49            SUBS             R1,R1,#1    ;R1 <- MAX_STRING -
                                                             1
  442 0000015A 2200            MOVS             R2,#0       ;clear R2   
  443 0000015C 0003            MOVS             R3,R0       ;store string point
                                                            er 
  444 0000015E         GSLOOP
  445 0000015E F000 F922       BL               GetChar     ;store character fr
                                                            om string
  446 00000162 428A            CMP              R2,R1       ;is the string smal
                                                            ler than MAX_STRING
                                                            ?
  447 00000164 D208            BHS              OVRFLW      ;if yes, branch    
                                                             
  448 00000166 280D            CMP              R0,#0x0D
  449 00000168 D010            BEQ              GSQUIT      ;quit on carriage r
                                                            eturn
  450 0000016A 287F            CMP              R0,#0x7F
  451 0000016C D007            BEQ              ADDCHK      ;go back one on bac
                                                            kspace
  452 0000016E 5498            STRB             R0,[R3,R2]  ;store char in M[R3
                                                            +R2]
  453 00000170 F7FF FFFE       BL               PutChar     ;print the characte
                                                            r         
  454 00000174 1C52            ADDS             R2,R2,#1    ;increment offset  
                                                                    
  455 00000176 E7F2            B                GSLOOP      ;go to start of loo
                                                            p
  456 00000178         OVRFLW
  457 00000178 280D            CMP              R0,#0x0D
  458 0000017A D007            BEQ              GSQUIT      ;quit on carriage r
                                                            eturn
  459 0000017C E7EF            B                GSLOOP      ;go to start of loo
                                                            p
  460 0000017E         ADDCHK
  461 0000017E 2A00            CMP              R2,#0
  462 00000180 D0ED            BEQ              GSLOOP      ;go to start of loo
                                                            p if backspaced on 



ARM Macro Assembler    Page 12 Timer Driver Input Timing


                                                            nothing
  463 00000182 1E52            SUBS             R2,R2,#1    ;else go back one b
                                                            yte
  464 00000184 207F            MOVS             R0,#0x7F    ;load backspace int
                                                            o R0
  465 00000186 F7FF FFFE       BL               PutChar     ;send backspace to 
                                                            command line
  466 0000018A E7E8            B                GSLOOP      ;go to start of loo
                                                            p
  467 0000018C         GSQUIT
  468 0000018C 2000            MOVS             R0,#0       ;clear R0
  469 0000018E 5498            STRB             R0,[R3,R2]  ;store 0 in M[R3+R2
                                                            ]
  470 00000190 200D            MOVS             R0,#0x0D    ;load carriage retu
                                                            rn into R0
  471 00000192 F7FF FFFE       BL               PutChar     ;print carriage ret
                                                            urn
  472 00000196 200A            MOVS             R0,#0x0A    ;load line feed int
                                                            o R0
  473 00000198 F7FF FFFE       BL               PutChar     ;print line feed
  474 0000019C BD0F            POP              {R0,R1,R2,R3,PC} ;restore regis
                                                            ter values
  475 0000019E         
  476 0000019E                 ENDP
  477 0000019E         
  478 0000019E         PutStringSB
                               PROC             {R0-R14},{}
  479 0000019E         ;Print string to command line
  480 0000019E         ;Calls: PutChar
  481 0000019E         ;Input: R0
  482 0000019E         ;Output: Print to command line
  483 0000019E         ;Register Modifications:  
  484 0000019E B507            PUSH             {R0,R1,R2,LR} ;preserve registe
                                                            r values
  485 000001A0 2100            MOVS             R1,#0       ;clear R1
  486 000001A2 0002            MOVS             R2,R0       ;store string point
                                                            er in R2
  487 000001A4         PSLOOP
  488 000001A4 5C50            LDRB             R0,[R2,R1]  ;load character int
                                                            o R0
  489 000001A6 2800            CMP              R0,#0
  490 000001A8 D003            BEQ              PSQUIT      ;quit on Null
  491 000001AA 1C49            ADDS             R1,R1,#1    ;increment offset
  492 000001AC F7FF FFFE       BL               PutChar     ;print the characte
                                                            r
  493 000001B0 E7F8            B                PSLOOP      ;go to start of loo
                                                            p
  494 000001B2         PSQUIT
  495 000001B2 BD07            POP              {R0,R1,R2,PC} ;restore register
                                                             values
  496 000001B4         
  497 000001B4                 ENDP
  498 000001B4         
  499 000001B4         PutNumU PROC             {R0-R14},{}
  500 000001B4         ;Prints decimal representation of the unsigned word valu
                       e in R0
  501 000001B4         ;Calls: DIVU, PutChar
  502 000001B4         ;Input: R0
  503 000001B4         ;Output: Print to command line



ARM Macro Assembler    Page 13 Timer Driver Input Timing


  504 000001B4         ;Register Modifications:
  505 000001B4 B507            PUSH             {R0,R1,R2,LR} ;preserve registe
                                                            r values
  506 000001B6 2800            CMP              R0,#0       ;if number is 0
  507 000001B8 D024            BEQ              ISZERO      ;branch
  508 000001BA 2200            MOVS             R2,#0       ;clear R2
  509 000001BC 0001            MOVS             R1,R0       ;set R1 to number 
  510 000001BE 4883            LDR              R0,=DIV1M
  511 000001C0 F7FF FFFE       BL               DIVU        ;Number/1000000
  512 000001C4 F000 F841       BL               PRNTHLPR    ;print result
  513 000001C8 4881            LDR              R0,=DIV100K
  514 000001CA F7FF FFFE       BL               DIVU        ;Number/100000
  515 000001CE F000 F83C       BL               PRNTHLPR    ;print result
  516 000001D2 4880            LDR              R0,=DIV10K
  517 000001D4 F7FF FFFE       BL               DIVU        ;Number/10000
  518 000001D8 F000 F837       BL               PRNTHLPR    ;print result
  519 000001DC 487E            LDR              R0,=DIV1K
  520 000001DE F7FF FFFE       BL               DIVU        ;Number/1000
  521 000001E2 F000 F832       BL               PRNTHLPR    ;print result
  522 000001E6 2064            MOVS             R0,#0x64
  523 000001E8 F7FF FFFE       BL               DIVU        ;Number/100
  524 000001EC F000 F82D       BL               PRNTHLPR    ;print result
  525 000001F0 200A            MOVS             R0,#0xA
  526 000001F2 F7FF FFFE       BL               DIVU        ;Number/10
  527 000001F6 F000 F828       BL               PRNTHLPR    ;print result
  528 000001FA 0008            MOVS             R0,R1       ;load remainder int
                                                            o R0
  529 000001FC 3030            ADDS             R0,R0,#0x30 ;convert to ascii
  530 000001FE F7FF FFFE       BL               PutChar     ;print the number
  531 00000202 BD07            POP              {R0,R1,R2,PC} ;restore register
                                                             values
  532 00000204         ISZERO
  533 00000204 2030            MOVS             R0,#0x30
  534 00000206 F7FF FFFE       BL               PutChar     ;print "0"
  535 0000020A BD07            POP              {R0,R1,R2,PC} ;restore register
                                                             values
  536 0000020C                 ENDP
  537 0000020C         
  538 0000020C         DIVU    PROC             {R2-R14},{}
  539 0000020C         ;Computes R1 / R0 into R0 remainder R1
  540 0000020C         ;Calls: DIVU, PutChar
  541 0000020C         ;Input: R0, R1
  542 0000020C         ;Output: R0, R1
  543 0000020C         ;Register Modifications: R0, R1
  544 0000020C B418            PUSH             {R3,R4}     ;store values of R3
                                                             and R4
  545 0000020E 2800            CMP              R0, #0      ;compare divisor to
                                                             0
  546 00000210 D002            BEQ              SET_CAR     ;if divisor is 0, g
                                                            o to special case
  547 00000212 2900            CMP              R1, #0      ;compare dividend t
                                                            o zero
  548 00000214 D00E            BEQ              ZERODIV     ;if dividend is 0, 
                                                            
  549 00000216 E007            B                BRK         ;go to special case
                                                            
  550 00000218         SET_CAR
  551 00000218 F3EF 8300       MRS              R3,APSR     ;set C flag to 1
  552 0000021C 2420            MOVS             R4,#0x20



ARM Macro Assembler    Page 14 Timer Driver Input Timing


  553 0000021E 0624            LSLS             R4,R4,#24
  554 00000220 4323            ORRS             R3,R3,R4
  555 00000222 F383 8800       MSR              APSR,R3
  556 00000226 E00E            B                ENDDIV
  557 00000228         BRK
  558 00000228 2300            MOVS             R3, #0      ;put quotient in R3
                                                            
  559 0000022A         
  560 0000022A         DIVWHILE
  561 0000022A 4288            CMP              R0, R1      ;compare R0 and R1
  562 0000022C D803            BHI              ENDDIVWHILE ;if R0<R1 exit the 
                                                            loop
  563 0000022E 1C5B            ADDS             R3, R3, #1  ;quotient ++
  564 00000230 1A09            SUBS             R1, R1, R0  ;R1 = R1 - R0
  565 00000232 E7FA            B                DIVWHILE
  566 00000234         
  567 00000234         ZERODIV
  568 00000234 2300            MOVS             R3,#0       ;IF dividend is zer
                                                            o, remainder is alw
                                                            ays zero
  569 00000236         ENDDIVWHILE
  570 00000236 0018            MOVS             R0, R3      ;R0 <- quotient, re
                                                            mainder = R1
  571 00000238 F3EF 8300       MRS              R3,APSR     ;clear C flag to 0
  572 0000023C 2420            MOVS             R4,#0x20
  573 0000023E 0624            LSLS             R4,R4,#24
  574 00000240 43A3            BICS             R3,R3,R4
  575 00000242 F383 8800       MSR              APSR,R3
  576 00000246         
  577 00000246         ENDDIV
  578 00000246 BC18            POP              {R3,R4}     ;clear changes from
                                                             registers
  579 00000248 4770            BX               LR          ;quit subroutine
  580 0000024A                 ENDP
  581 0000024A         
  582 0000024A         PRNTHLPR
  583 0000024A         ;Prints character if character is not a leading zero
  584 0000024A         ;Calls: PutChar
  585 0000024A         ;Input: R0, R2
  586 0000024A         ;Output: R0, R2
  587 0000024A         ;Register Modifications: R0, R2
  588 0000024A         
  589 0000024A B500            PUSH             {LR}        ;preserve register 
                                                            values
  590 0000024C 2A01            CMP              R2,#1       ;if character isnt 
                                                            a leading character
                                                            
  591 0000024E D001            BEQ              PRINTCHAR   ;print it
  592 00000250 2800            CMP              R0,#0       ;if character is le
                                                            ading zero
  593 00000252 D003            BEQ              PRNTQUITT   ;quit
  594 00000254         PRINTCHAR
  595 00000254 3030            ADDS             R0,R0,#0x30 ;convert char to as
                                                            cii
  596 00000256 F7FF FFFE       BL               PutChar     ;print character
  597 0000025A 2201            MOVS             R2,#1       ;indicates all futu
                                                            re numbers aren't l
                                                            eading
  598 0000025C         PRNTQUITT



ARM Macro Assembler    Page 15 Timer Driver Input Timing


  599 0000025C BD00            POP              {PC}        ;restore register v
                                                            alues
  600 0000025E         
  601 0000025E         NEWLINE
  602 0000025E         ;Prints a carriage return and a line feed
  603 0000025E         ;Calls: PutChar
  604 0000025E         ;Input:
  605 0000025E         ;Output: Print to command line
  606 0000025E         ;Register Modifications: 
  607 0000025E B501            PUSH             {R0,LR}     ;preserve register 
                                                            values
  608 00000260 200D            MOVS             R0,#0x0D    ;load carriage retu
                                                            rn into R0
  609 00000262 F7FF FFFE       BL               PutChar     ;print carriage ret
                                                            urn
  610 00000266 200A            MOVS             R0,#0x0A    ;load line feed int
                                                            o R0
  611 00000268 F7FF FFFE       BL               PutChar     ;print line feed
  612 0000026C BD01            POP              {R0,PC}     ;restore register v
                                                            alues
  613 0000026E         
  614 0000026E         
  615 0000026E         Init_UART0_IRQ
                               PROC             {R0-R14},{}
  616 0000026E         ;Initializes UART0 to be used with interrupts
  617 0000026E B507            PUSH             {R0, R1, R2, LR}
  618 00000270         ;initialize transmit queue
  619 00000270 485A            LDR              R0, =TxQueue
  620 00000272 495B            LDR              R1, =TxQueueRecord
  621 00000274 F7FF FFFE       BL               InitQueue
  622 00000278         ;initialize receive queue
  623 00000278 485A            LDR              R0, =RxQueue
  624 0000027A 495B            LDR              R1, =RxQueueRecord
  625 0000027C F7FF FFFE       BL               InitQueue
  626 00000280         ;Select MCGPLLCLK / 2 as UART0 clock source
  627 00000280 485A            LDR              R0,=SIM_SOPT2
  628 00000282 495B            LDR              R1,=SIM_SOPT2_UART0SRC_MASK
  629 00000284 6802            LDR              R2,[R0,#0]
  630 00000286 438A            BICS             R2,R2,R1
  631 00000288 495A            LDR              R1,=SIM_SOPT2_UART0_MCGPLLCLK_D
IV2
  632 0000028A 430A            ORRS             R2,R2,R1
  633 0000028C 6002            STR              R2,[R0,#0]
  634 0000028E         ;Enable external connection for UART0
  635 0000028E 485A            LDR              R0,=SIM_SOPT5
  636 00000290 495A            LDR              R1,= SIM_SOPT5_UART0_EXTERN_MAS
K_CLEAR
  637 00000292 6802            LDR              R2,[R0,#0]
  638 00000294 438A            BICS             R2,R2,R1
  639 00000296 6002            STR              R2,[R0,#0]
  640 00000298         ;Enable clock for UART0 module
  641 00000298 4859            LDR              R0,=SIM_SCGC4
  642 0000029A 495A            LDR              R1,= SIM_SCGC4_UART0_MASK
  643 0000029C 6802            LDR              R2,[R0,#0]
  644 0000029E 430A            ORRS             R2,R2,R1
  645 000002A0 6002            STR              R2,[R0,#0]
  646 000002A2         ;Enable clock for Port A module
  647 000002A2 4859            LDR              R0,=SIM_SCGC5
  648 000002A4 4959            LDR              R1,= SIM_SCGC5_PORTA_MASK



ARM Macro Assembler    Page 16 Timer Driver Input Timing


  649 000002A6 6802            LDR              R2,[R0,#0]
  650 000002A8 430A            ORRS             R2,R2,R1
  651 000002AA 6002            STR              R2,[R0,#0]
  652 000002AC         ;Connect PORT A Pin 1 (PTA1) to UART0 Rx (J1 Pin 02)
  653 000002AC 4858            LDR              R0,=PORTA_PCR1
  654 000002AE 4959            LDR              R1,=PORT_PCR_SET_PTA1_UART0_RX
  655 000002B0 6001            STR              R1,[R0,#0]
  656 000002B2         ;Connect PORT A Pin 2 (PTA2) to UART0 Tx (J1 Pin 04)
  657 000002B2 4859            LDR              R0,=PORTA_PCR2
  658 000002B4 4957            LDR              R1,=PORT_PCR_SET_PTA2_UART0_TX
  659 000002B6 6001            STR              R1,[R0,#0]
  660 000002B8         ;Disable UART0 receiver and transmitter
  661 000002B8 4858            LDR              R0,=UART0_BASE
  662 000002BA 210C            MOVS             R1,#UART0_C2_T_R
  663 000002BC 78C2            LDRB             R2,[R0,#UART0_C2_OFFSET]
  664 000002BE 438A            BICS             R2,R2,R1
  665 000002C0 70C2            STRB             R2,[R0,#UART0_C2_OFFSET]
  666 000002C2         ;Initialize NVIC for UART0 Interrupts
  667 000002C2         ;Set UART0 IRQ Priority
  668 000002C2 4857            LDR              R0, =UART0_IPR
  669 000002C4 4957            LDR              R1, =NVIC_IPR_UART0_MASK
  670 000002C6 4A57            LDR              R2, =NVIC_IPR_UART0_PRI_3
  671 000002C8 6803            LDR              R3, [R0, #0]
  672 000002CA 438B            BICS             R3, R3, R1
  673 000002CC 4313            ORRS             R3, R3, R2
  674 000002CE 6003            STR              R3, [R0, #0]
  675 000002D0         ;Clear any pending UART0 Interrupts
  676 000002D0 4855            LDR              R0, =NVIC_ICPR
  677 000002D2 4956            LDR              R1, =NVIC_ICPR_UART0_MASK
  678 000002D4 6001            STR              R1, [R0, #0]
  679 000002D6         ;Unmask UART0 interrupts
  680 000002D6 4856            LDR              R0, =NVIC_ISER
  681 000002D8 4954            LDR              R1, =NVIC_ISER_UART0_MASK
  682 000002DA 6001            STR              R1, [R0, #0]
  683 000002DC         ;Init UART0 for 8N1 format at 9600 Baud,
  684 000002DC         ;and enable the recieve interrupt
  685 000002DC 484F            LDR              R0, =UART0_BASE
  686 000002DE 2101            MOVS             R1,#UART0_BDH_9600
  687 000002E0 7001            STRB             R1,[R0,#UART0_BDH_OFFSET]
  688 000002E2 2138            MOVS             R1,#UART0_BDL_9600
  689 000002E4 7041            STRB             R1,[R0,#UART0_BDL_OFFSET]
  690 000002E6 2100            MOVS             R1,#UART0_C1_8N1
  691 000002E8 7081            STRB             R1,[R0,#UART0_C1_OFFSET]
  692 000002EA 2100            MOVS             R1,#UART0_C3_NO_TXINV
  693 000002EC 7181            STRB             R1,[R0,#UART0_C3_OFFSET]
  694 000002EE 210F            MOVS             R1,#UART0_C4_NO_MATCH_OSR_16
  695 000002F0 7281            STRB             R1,[R0,#UART0_C4_OFFSET]
  696 000002F2 2100            MOVS             R1,#UART0_C5_NO_DMA_SSR_SYNC
  697 000002F4 72C1            STRB             R1,[R0,#UART0_C5_OFFSET]
  698 000002F6 211F            MOVS             R1,#UART0_S1_CLEAR_FLAGS
  699 000002F8 7101            STRB             R1,[R0,#UART0_S1_OFFSET]
  701 000002FA 21C0            MOVS             R1,     #UART0_S2_NO_RXINV_BRK
10_NO_LBKDETECT_CLEAR_FLAGS
  702 000002FC 7141            STRB             R1,[R0,#UART0_S2_OFFSET]
  703 000002FE         ;Enable UART0 transmitter, transmitter interrupt,
  704 000002FE         ;receiver, and receive interrupt
  705 000002FE 212C            MOVS             R1,#UART0_C2_T_RI
  706 00000300 70C1            STRB             R1,[R0,#UART0_C2_OFFSET]
  707 00000302         ;Pop prevous R0-2 values off the stack.



ARM Macro Assembler    Page 17 Timer Driver Input Timing


  708 00000302 BD07            POP              {R0, R1, R2, PC}
  709 00000304                 ENDP
  710 00000304         
  711 00000304         
  712 00000304         Init_PIT_IRQ
                               PROC             {R0-R14},{}
  713 00000304         ;Init_PIT_IRQ: Initalize the PIT to generate an 
  714 00000304         ;interrupt every 0.01 seconds from channel 0 
  715 00000304         
  716 00000304 B672            CPSID            I
  717 00000306 B507            PUSH             {R0-R2, LR}
  718 00000308 484A            LDR              R0, =SIM_SCGC6
  719 0000030A 494B            LDR              R1, =SIM_SCGC6_PIT_MASK
  720 0000030C 6802            LDR              R2, [R0, #0] ;current SIM_SCGC6
                                                             value
  721 0000030E 430A            ORRS             R2, R2, R1  ;only PIT bit set
  722 00000310 6002            STR              R2, [R0, #0] ;update SIM_SCGC6
  723 00000312 484A            LDR              R0, =PIT_BASE ;Enable PIT timer
                                                             module
  724 00000314 494A            LDR              R1, =PIT_MCR_EN_FRZ
  725 00000316 6001            STR              R1, [R0, #PIT_MCR_OFFSET]
  726 00000318 484A            LDR              R0, =PIT_CH0_BASE
  727 0000031A 494B            LDR              R1, =PIT_LDVAL_10ms
  728 0000031C 6001            STR              R1, [R0, #PIT_LDVAL_OFFSET]
  729 0000031E 4849            LDR              R0, =PIT_CH0_BASE ;Enable PIT t
                                                            imer channel 0 for 
                                                            interrupts
  730 00000320 4947            LDR              R1, =PIT_TCTRL_TEN_MASK
  731 00000322 6882            LDR              R2, [R0, #PIT_TCTRL_OFFSET]
  732 00000324 438A            BICS             R2, R2, R1
  733 00000326 6082            STR              R2, [R0, #PIT_TCTRL_OFFSET]
  734 00000328 4846            LDR              R0, =PIT_CH0_BASE ;Enable PIT t
                                                            imer channel 0 for 
                                                            interrupts
  735 0000032A 2103            MOVS             R1, #PIT_TCTRL_CH_IE
  736 0000032C 6081            STR              R1, [R0, #PIT_TCTRL_OFFSET]
  737 0000032E         ;Unmask PIT Interrupts
  738 0000032E 4840            LDR              R0, =NVIC_ISER
  739 00000330 4946            LDR              R1, =PIT_IRQ_MASK
  740 00000332 6001            STR              R1, [R0, #0]
  741 00000334         ;Set PIT Interrupt Priority
  742 00000334 4846            LDR              R0, =PIT_IPR
  743 00000336 4944            LDR              R1, =(PIT_IRQ_PRI << PIT_PRI_PO
S)
  744 00000338 6001            STR              R1, [R0, #0]
  745 0000033A B662            CPSIE            I
  746 0000033C BD07            POP              {R0-R2, PC}
  747 0000033E                 ENDP
  748 0000033E         
  749 0000033E         PIT_ISR PROC             {R0-R14},{}
  750 0000033E         ;On a PIT interrupt, if the (byte) variable RunStopWatch
                       
  751 0000033E         ;is not equal to zero, the (word) variable Count is incr
                       emented
  752 0000033E         ;otherwise, it leaves Count unchanged. 
  753 0000033E         ;Interrupt condition is then cleard
  754 0000033E         
  755 0000033E 4846            LDR              R0, =RunStopWatch
  756 00000340 7800            LDRB             R0, [R0, #0]



ARM Macro Assembler    Page 18 Timer Driver Input Timing


  757 00000342 2800            CMP              R0, #0
  758 00000344 D100            BNE              PITISRINCR
  759 00000346 E003            B                QUITPITISR
  760 00000348         PITISRINCR
  761 00000348 4844            LDR              R0, =Count  ;increment count if
                                                             stopwatch is runni
                                                            ng 
  762 0000034A 6801            LDR              R1, [R0, #0]
  763 0000034C 1C49            ADDS             R1, R1, #1
  764 0000034E 6001            STR              R1, [R0, #0]
  765 00000350         QUITPITISR
  766 00000350 483C            LDR              R0, =PIT_CH0_BASE ;clear interr
                                                            upt condition
  767 00000352 493B            LDR              R1, =PIT_TFLG_TIF_MASK
  768 00000354 60C1            STR              R1, [R0, #PIT_TFLG_OFFSET]
  769 00000356 4770            BX               LR
  770 00000358                 ENDP
  771 00000358         
  772 00000358         
  773 00000358         
  774 00000358         UART0_ISR
                               PROC             {R0-R14},{}
  775 00000358         ;handles UART0 transmit and receive interrupts
  776 00000358 B672            CPSID            I           ;Mask  interrupts
  777 0000035A B50F            PUSH             {LR, R0-R3} ;preserve reg value
                                                            s
  778 0000035C 482F            LDR              R0, =UART0_BASE
  779 0000035E 78C1            LDRB             R1,[R0,#UART0_C2_OFFSET]
  780 00000360 2280            MOVS             R2, #0x80
  781 00000362 4011            ANDS             R1, R1, R2
  782 00000364 2900            CMP              R1, #0
  783 00000366 D100            BNE              TXEN
  784 00000368 E00F            B                CHECKRX     ;check for rx inter
                                                            rupt
  785 0000036A         TXEN
  786 0000036A 7901            LDRB             R1,[R0,#UART0_S1_OFFSET]
  787 0000036C 2280            MOVS             R2, #0x80
  788 0000036E 4011            ANDS             R1, R1, R2
  789 00000370 2900            CMP              R1, #0
  790 00000372 D00A            BEQ              CHECKRX
  791 00000374 491A            LDR              R1, =TxQueueRecord 
                                                            ;Dequeue character
  792 00000376 2204            MOVS             R2, #Q_BUF_SZ ;initialize queue
                                                            
  793 00000378 F7FF FFFE       BL               Dequeue
  794 0000037C D202            BCS              TXDA        ;dequeue failed
  795 0000037E 4927            LDR              R1, =UART0_BASE ;dequeue worked
                                                            
  796 00000380 71C8            STRB             R0, [R1, #UART0_D_OFFSET]
  797 00000382 E00E            B                QUITISR
  798 00000384         TXDA
  799 00000384 212C            MOVS             R1,#UART0_C2_T_RI
  800 00000386 70C1            STRB             R1,[R0,#UART0_C2_OFFSET]
  801 00000388 E00B            B                QUITISR
  802 0000038A         CHECKRX
  803 0000038A 4824            LDR              R0, =UART0_BASE
  804 0000038C 7901            LDRB             R1,[R0,#UART0_S1_OFFSET] ;check
                                                             for rx interrupt
  805 0000038E 2210            MOVS             R2, #0x10



ARM Macro Assembler    Page 19 Timer Driver Input Timing


  806 00000390 4011            ANDS             R1, R1, R2
  807 00000392 2900            CMP              R1, #0
  808 00000394 D005            BEQ              QUITISR
  809 00000396 4821            LDR              R0, =UART0_BASE
  810 00000398 79C3            LDRB             R3, [R0, #UART0_D_OFFSET]
  811 0000039A 4913            LDR              R1, =RxQueueRecord
  812 0000039C 0018            MOVS             R0, R3
  813 0000039E F7FF FFFE       BL               Enqueue     ;enqueue character
  814 000003A2         QUITISR
  815 000003A2 B662            CPSIE            I
  816 000003A4 BD0F            POP              {R0-R3, PC}
  817 000003A6                 ENDP
  818 000003A6         
  819 000003A6         
  820 000003A6         GetChar
  821 000003A6         ;Dequeues a character from the receive queue, and return
                       s it in R0.
  822 000003A6         ;Input: None
  823 000003A6         ;Output: R0
  824 000003A6         ;Modified Registers: R0
  825 000003A6 B506            PUSH             {R1, R2, LR} ;preserve reg valu
                                                            es
  826 000003A8 490F            LDR              R1,=RxQueueRecord ;load queue r
                                                            ecord address into 
                                                            R1
  827 000003AA         GETCHARLOOP
  828 000003AA B672            CPSID            I           ;Mask interrupts
  829 000003AC F7FF FFFE       BL               Dequeue     ;dequeue character 
                                                            from receive queue
  830 000003B0 B662            CPSIE            I           ;enable interrupts
  831 000003B2 D2FA            BCS              GETCHARLOOP
  832 000003B4 BD06            POP              {R1, R2, PC}
  833 000003B6         
  834 000003B6         PutChar
  835 000003B6         ;Enqueues the character from R0 to the transmit queue.
  836 000003B6         ;Input: R0
  837 000003B6         ;Output: Prints to terminall
  838 000003B6         ;Register modifications: None
  839 000003B6         
  840 000003B6 B503            PUSH             {R0, R1, LR}
  841 000003B8         PUTCHARLOOP
  842 000003B8 4909            LDR              R1,=TxQueueRecord
  843 000003BA B672            CPSID            I           ;Mask interrupts
  844 000003BC F7FF FFFE       BL               Enqueue     ;Enqueue char from 
                                                            R0 to transmit queu
                                                            e
  845 000003C0 B662            CPSIE            I           ;enable interrupts
  846 000003C2 D2F9            BCS              PUTCHARLOOP
  847 000003C4 21AC            MOVS             R1,#UART0_C2_TI_RI ;Enable UART
                                                            0 Transmitter, reci
                                                            ever, and rx interr
                                                            upt
  848 000003C6 4815            LDR              R0, =UART0_BASE
  849 000003C8 70C1            STRB             R1,[R0,#UART0_C2_OFFSET]
  850 000003CA BD03            POP              {R0, R1, PC} ;restore register 
                                                            values
  851 000003CC         ;>>>>>   end subroutine code <<<<<
  852 000003CC                 ALIGN
  853 000003CC         ;*******************************************************



ARM Macro Assembler    Page 20 Timer Driver Input Timing


                       *********
  854 000003CC         ;Vector Table Mapped to Address 0 at Reset
  855 000003CC         ;Linker requires __Vectors to be exported
  856 000003CC 000F4240 
              000186A0 
              00002710 
              000003E8 
              00000000 
              00000000 
              00000000 
              00000000 
              40048004 
              0C000000 
              04010000 
              40048010 
              00010007 
              40048034 
              00000400 
              40048038 
              00000200 
              40049004 
              01000200 
              40049008 
              4006A000 
              E000E40C 
              000000C0 
              E000E280 
              00001000 
              E000E100 
              4004803C 
              00800000 
              40037000 
              00000001 
              40037100 
              00000000 
              00400000 
              E000E414 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000         AREA             RESET, DATA, READONLY
  857 00000000                 EXPORT           __Vectors
  858 00000000                 EXPORT           __Vectors_End
  859 00000000                 EXPORT           __Vectors_Size
  860 00000000                 IMPORT           __initial_sp
  861 00000000                 IMPORT           Dummy_Handler
  862 00000000                 IMPORT           HardFault_Handler
  863 00000000         __Vectors
  864 00000000         ;ARM core vectors
  865 00000000 00000000        DCD              __initial_sp ;00:end of stack
  866 00000004 00000000        DCD              Reset_Handler ;01:reset vector
  867 00000008 00000000        DCD              Dummy_Handler ;02:NMI
  868 0000000C 00000000        DCD              HardFault_Handler 
                                                            ;03:hard fault
  869 00000010 00000000        DCD              Dummy_Handler ;04:(reserved)
  870 00000014 00000000        DCD              Dummy_Handler ;05:(reserved)



ARM Macro Assembler    Page 21 Timer Driver Input Timing


  871 00000018 00000000        DCD              Dummy_Handler ;06:(reserved)
  872 0000001C 00000000        DCD              Dummy_Handler ;07:(reserved)
  873 00000020 00000000        DCD              Dummy_Handler ;08:(reserved)
  874 00000024 00000000        DCD              Dummy_Handler ;09:(reserved)
  875 00000028 00000000        DCD              Dummy_Handler ;10:(reserved)
  876 0000002C 00000000        DCD              Dummy_Handler ;11:SVCall (super
                                                            visor call)
  877 00000030 00000000        DCD              Dummy_Handler ;12:(reserved)
  878 00000034 00000000        DCD              Dummy_Handler ;13:(reserved)
  879 00000038 00000000        DCD              Dummy_Handler ;14:PendableSrvRe
                                                            q (pendable request
                                                             
  880 0000003C         ;   for system service)
  881 0000003C 00000000        DCD              Dummy_Handler ;15:SysTick (syst
                                                            em tick timer)
  882 00000040 00000000        DCD              Dummy_Handler ;16:DMA channel 0
                                                             xfer complete/erro
                                                            r
  883 00000044 00000000        DCD              Dummy_Handler ;17:DMA channel 1
                                                             xfer complete/erro
                                                            r
  884 00000048 00000000        DCD              Dummy_Handler ;18:DMA channel 2
                                                             xfer complete/erro
                                                            r
  885 0000004C 00000000        DCD              Dummy_Handler ;19:DMA channel 3
                                                             xfer complete/erro
                                                            r
  886 00000050 00000000        DCD              Dummy_Handler ;20:(reserved)
  887 00000054 00000000        DCD              Dummy_Handler ;21:command compl
                                                            ete; read collision
                                                            
  888 00000058 00000000        DCD              Dummy_Handler ;22:low-voltage d
                                                            etect;
  889 0000005C         ;   low-voltage warning
  890 0000005C 00000000        DCD              Dummy_Handler ;23:low leakage w
                                                            akeup
  891 00000060 00000000        DCD              Dummy_Handler ;24:I2C0
  892 00000064 00000000        DCD              Dummy_Handler ;25:I2C1
  893 00000068 00000000        DCD              Dummy_Handler ;26:SPI0 (all IRQ
                                                             sources)
  894 0000006C 00000000        DCD              Dummy_Handler ;27:SPI1 (all IRQ
                                                             sources)
  895 00000070 00000000        DCD              UART0_ISR   ;28:UART0 (status; 
                                                            error)
  896 00000074 00000000        DCD              Dummy_Handler ;29:UART1 (status
                                                            ; error)
  897 00000078 00000000        DCD              Dummy_Handler ;30:UART2 (status
                                                            ; error)
  898 0000007C 00000000        DCD              Dummy_Handler ;31:ADC0
  899 00000080 00000000        DCD              Dummy_Handler ;32:CMP0
  900 00000084 00000000        DCD              Dummy_Handler ;33:TPM0
  901 00000088 00000000        DCD              Dummy_Handler ;34:TPM1
  902 0000008C 00000000        DCD              Dummy_Handler ;35:TPM2
  903 00000090 00000000        DCD              Dummy_Handler ;36:RTC (alarm)
  904 00000094 00000000        DCD              Dummy_Handler ;37:RTC (seconds)
                                                            
  905 00000098 00000000        DCD              PIT_ISR     ;38:PIT (all IRQ so
                                                            urces)
  906 0000009C 00000000        DCD              Dummy_Handler ;39:I2S0



ARM Macro Assembler    Page 22 Timer Driver Input Timing


  907 000000A0 00000000        DCD              Dummy_Handler ;40:USB0
  908 000000A4 00000000        DCD              Dummy_Handler ;41:DAC0
  909 000000A8 00000000        DCD              Dummy_Handler ;42:TSI0
  910 000000AC 00000000        DCD              Dummy_Handler ;43:MCG
  911 000000B0 00000000        DCD              Dummy_Handler ;44:LPTMR0
  912 000000B4 00000000        DCD              Dummy_Handler ;45:Segment LCD
  913 000000B8 00000000        DCD              Dummy_Handler ;46:PORTA pin det
                                                            ect
  914 000000BC 00000000        DCD              Dummy_Handler ;47:PORTC and POR
                                                            TD pin detect
  915 000000C0         __Vectors_End
  916 000000C0 000000C0 
                       __Vectors_Size
                               EQU              __Vectors_End - __Vectors
  917 000000C0                 ALIGN
  918 000000C0         ;*******************************************************
                       *********
  919 000000C0         ;Constants
  920 000000C0                 AREA             MyConst,DATA,READONLY
  921 00000000         ;>>>>> begin constants here <<<<<
  922 00000000 45 6E 74 
              65 72 20 
              79 6F 75 
              72 20 6E 
              61 6D 65 
              2E 00    Prompt1 DCB              "Enter your name.", 0
  923 00000011 45 6E 74 
              65 72 20 
              74 68 65 
              20 64 61 
              74 65 2E 
              00       Prompt2 DCB              "Enter the date.", 0
  924 00000021 45 6E 74 
              65 72 20 
              74 68 65 
              20 6C 61 
              73 74 20 
              6E 61 6D 
              65 20 6F 
              66 20 61 
              20 32 35 
              30 20 6C 
              61 62 20 
              54 41 2E 
              00       Prompt3 DCB              "Enter the last name of a 250 l
ab TA.", 0
  925 00000046 54 68 61 
              6E 6B 20 
              79 6F 75 
              2E 20 47 
              6F 6F 64 
              62 79 65 
              21 00    ThxPrompt
                               DCB              "Thank you. Goodbye!", 0
  926 0000005A 20 78 20 
              30 2E 30 
              31 20 73 
              00       TimeFrmtTxt
                               DCB              " x 0.01 s", 0



ARM Macro Assembler    Page 23 Timer Driver Input Timing


  927 00000064         
  928 00000064         ;>>>>>   end constants here <<<<<
  929 00000064                 ALIGN
  930 00000064         ;*******************************************************
                       *********
  931 00000064         ;Variables
  932 00000064                 AREA             MyData,DATA,READWRITE
  933 00000000         ;>>>>> begin variables here <<<<<
  934 00000000 00 00 00 
              00       QBuffer SPACE            Q_BUF_SZ    ;Queue contents 
  935 00000004 00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 QRecord SPACE            Q_REC_SZ    ;Queue management r
                                                            ecord 
  936 00000016 00 00           ALIGN
  937 00000018 00 00 00 
              00       RxQueue SPACE            Q_BUF_SZ
  938 0000001C 00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 RxQueueRecord
                               SPACE            Q_REC_SZ
  939 0000002E 00 00           ALIGN
  940 00000030 00 00 00 
              00       TxQueue SPACE            Q_BUF_SZ
  941 00000034 00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 TxQueueRecord
                               SPACE            Q_REC_SZ
  942 00000046 00 00           ALIGN
  943 00000048 00      RunStopWatch
                               SPACE            1
  944 00000049 00 00 00        ALIGN
  945 0000004C 00 00 00 
              00       Count   SPACE            4
  946 00000050 00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 



ARM Macro Assembler    Page 24 Timer Driver Input Timing


              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00 00 00 
              00       STRINGIN
                               SPACE            MAX_STRING
  947 0000009F         ;>>>>>   end variables here <<<<<
  948 0000009F 00              ALIGN
  949 000000A0                 END
Command Line: --debug --diag_suppress=9931 --cpu=Cortex-M0+ --apcs=interwork --
depend=.\objects\exercise10.d -o.\objects\exercise10.o -I.\RTE\_Target_1 -IC:\K
eil_v5\ARM\PACK\Keil\Kinetis_KLxx_DFP\1.13.0\Device\Include -IC:\Keil_v5\ARM\CM
SIS\Include --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 524
" --predefine="MKL46Z256xxx4 SETA 1" --list=.\listings\exercise10.lst exercise1
0.s
